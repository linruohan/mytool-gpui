# é€šçŸ¥ç³»ç»Ÿä½¿ç”¨æŒ‡å—

## ğŸ“‹ æ¦‚è¿°

æ–°çš„é€šçŸ¥ç³»ç»Ÿç»“åˆäº† `tracing` æ—¥å¿—å’Œ GPUI çš„ `push_notification`ï¼Œæä¾›ç»Ÿä¸€çš„ç”¨æˆ·åé¦ˆæœºåˆ¶ã€‚

## ğŸ¯ è®¾è®¡ç›®æ ‡

1. **ç»Ÿä¸€æ¥å£** - ä¸€ä¸ªè°ƒç”¨åŒæ—¶è®°å½•æ—¥å¿—å’Œæ˜¾ç¤ºé€šçŸ¥
2. **åˆ†çº§ç®¡ç†** - Infoã€Successã€Warningã€Error å››ä¸ªçº§åˆ«
3. **çµæ´»ä½¿ç”¨** - æ”¯æŒåŒæ­¥å’Œå¼‚æ­¥åœºæ™¯
4. **å¼€å‘å‹å¥½** - æä¾›ä¾¿æ·å®ç®€åŒ–è°ƒç”¨

## ğŸ“¦ æ ¸å¿ƒ API

### NotificationSystem æ–¹æ³•

```rust
use crate::core::notification::NotificationSystem;

// 1. ä¿¡æ¯é€šçŸ¥ï¼ˆè“è‰²å›¾æ ‡ï¼‰
NotificationSystem::info("Loading data...", window, cx);
// æ—¥å¿—: INFO Loading data...
// é€šçŸ¥: Loading data...

// 2. æˆåŠŸé€šçŸ¥ï¼ˆç»¿è‰²å‹¾å·ï¼‰
NotificationSystem::success("Item saved successfully", window, cx);
// æ—¥å¿—: INFO âœ“ Item saved successfully
// é€šçŸ¥: âœ“ Item saved successfully

// 3. è­¦å‘Šé€šçŸ¥ï¼ˆé»„è‰²è­¦å‘Šï¼‰
NotificationSystem::warning("Network connection unstable", window, cx);
// æ—¥å¿—: WARN âš  Network connection unstable
// é€šçŸ¥: âš  Network connection unstable

// 4. é”™è¯¯é€šçŸ¥ï¼ˆçº¢è‰²é”™è¯¯ï¼‰
NotificationSystem::error("Failed to save item", window, cx);
// æ—¥å¿—: ERROR âœ— Failed to save item
// é€šçŸ¥: âœ— Failed to save item

// 5. ä»…æ—¥å¿—ï¼ˆä¸æ˜¾ç¤ºé€šçŸ¥ï¼‰
NotificationSystem::debug("Processing item 123");
// æ—¥å¿—: DEBUG Processing item 123
// é€šçŸ¥: æ— 

NotificationSystem::log_error("Database error", &error);
// æ—¥å¿—: ERROR Database error: ...
// é€šçŸ¥: æ— 
```

## ğŸ”§ ä½¿ç”¨åœºæ™¯

### åœºæ™¯ 1: åŒæ­¥æ“ä½œåé¦ˆ

```rust
fn on_button_click(&mut self, window: &mut Window, cx: &mut Context<Self>) {
    // æ“ä½œå‰æç¤º
    NotificationSystem::info("Processing...", window, cx);
    
    match perform_operation() {
        Ok(_) => {
            NotificationSystem::success("Operation completed", window, cx);
        }
        Err(e) => {
            NotificationSystem::error(
                format!("Operation failed: {}", e),
                window,
                cx
            );
        }
    }
}
```

### åœºæ™¯ 2: å¼‚æ­¥æ“ä½œåé¦ˆ

```rust
fn save_item(&mut self, item: Arc<ItemModel>, window: &mut Window, cx: &mut Context<Self>) {
    let db = get_db_connection(cx);
    
    cx.spawn(async move |_this, mut cx| {
        let store = todos::Store::new((*db).clone());
        
        match store.save_item(&item).await {
            Ok(_) => {
                NotificationSystem::debug("Item saved to database");
                
                // åœ¨ UI çº¿ç¨‹æ˜¾ç¤ºæˆåŠŸé€šçŸ¥
                cx.update(|cx| {
                    if let Some(window) = cx.windows().first() {
                        NotificationSystem::success("Item saved", window, cx);
                    }
                }).ok();
            }
            Err(e) => {
                NotificationSystem::log_error("Failed to save item", e);
                
                // åœ¨ UI çº¿ç¨‹æ˜¾ç¤ºé”™è¯¯é€šçŸ¥
                cx.update(|cx| {
                    if let Some(window) = cx.windows().first() {
                        NotificationSystem::error("Failed to save item", window, cx);
                    }
                }).ok();
            }
        }
    }).detach();
}
```

### åœºæ™¯ 3: åå°æ“ä½œï¼ˆä»…æ—¥å¿—ï¼‰

```rust
fn background_sync(&mut self, cx: &mut Context<Self>) {
    cx.spawn(async move |_this, _cx| {
        NotificationSystem::debug("Starting background sync");
        
        match sync_data().await {
            Ok(count) => {
                NotificationSystem::debug(format!("Synced {} items", count));
            }
            Err(e) => {
                // åå°é”™è¯¯åªè®°å½•æ—¥å¿—ï¼Œä¸æ‰“æ‰°ç”¨æˆ·
                NotificationSystem::log_error("Background sync failed", e);
            }
        }
    }).detach();
}
```

### åœºæ™¯ 4: ç”¨æˆ·æ“ä½œç¡®è®¤

```rust
fn delete_item(&mut self, item: Arc<ItemModel>, window: &mut Window, cx: &mut Context<Self>) {
    Dialog::new("Confirm Delete")
        .message("Are you sure you want to delete this item?")
        .on_confirm(move |_, window, cx| {
            delete_item_optimistic(item.clone(), cx);
            NotificationSystem::success("Item deleted", window, cx);
            true
        })
        .on_cancel(|_, window, cx| {
            NotificationSystem::info("Delete cancelled", window, cx);
            true
        })
        .show(window, cx);
}
```

## ğŸ¨ ä¾¿æ·å®ï¼ˆå¯é€‰ï¼‰

å¦‚æœéœ€è¦æ›´ç®€æ´çš„è¯­æ³•ï¼Œå¯ä»¥ä½¿ç”¨å®ï¼š

```rust
// åœ¨æ–‡ä»¶é¡¶éƒ¨å¯¼å…¥
use crate::{notify_success, notify_error, log_debug};

// ä½¿ç”¨å®
notify_success!(window, cx, "Item saved successfully");
notify_error!(window, cx, "Failed to save: {}", error_msg);
log_debug!("Processing item {}", item_id);
```

## ğŸ“Š æœ€ä½³å®è·µ

### âœ… æ¨èåšæ³•

1. **ç”¨æˆ·æ“ä½œåé¦ˆ** - ä½¿ç”¨ Success/Error é€šçŸ¥
```rust
NotificationSystem::success("Item created", window, cx);
NotificationSystem::error("Failed to create item", window, cx);
```

2. **åå°æ“ä½œ** - ä»…ä½¿ç”¨æ—¥å¿—
```rust
NotificationSystem::debug("Background task started");
NotificationSystem::log_error("Background task failed", error);
```

3. **è­¦å‘Šä¿¡æ¯** - ä½¿ç”¨ Warning é€šçŸ¥
```rust
NotificationSystem::warning("Network connection slow", window, cx);
```

4. **å¼‚æ­¥é”™è¯¯å¤„ç†** - åœ¨ UI çº¿ç¨‹æ˜¾ç¤ºé€šçŸ¥
```rust
cx.spawn(async move |_this, mut cx| {
    match operation().await {
        Err(e) => {
            NotificationSystem::log_error("Operation failed", e);
            cx.update(|cx| {
                if let Some(window) = cx.windows().first() {
                    NotificationSystem::error("Operation failed", window, cx);
                }
            }).ok();
        }
        _ => {}
    }
}).detach();
```

### âŒ é¿å…åšæ³•

1. **è¿‡åº¦é€šçŸ¥** - ä¸è¦ä¸ºæ¯ä¸ªå°æ“ä½œéƒ½æ˜¾ç¤ºé€šçŸ¥
```rust
// âŒ ä¸å¥½
NotificationSystem::info("Button clicked", window, cx);
NotificationSystem::info("Input changed", window, cx);

// âœ… å¥½
NotificationSystem::debug("Button clicked");
NotificationSystem::debug("Input changed");
```

2. **é‡å¤ä¿¡æ¯** - ä¸è¦åŒæ—¶ä½¿ç”¨ tracing å’Œ NotificationSystem
```rust
// âŒ ä¸å¥½
tracing::info!("Item saved");
NotificationSystem::success("Item saved", window, cx);

// âœ… å¥½
NotificationSystem::success("Item saved", window, cx);
```

3. **å¿½ç•¥é”™è¯¯** - ä¸è¦é™é»˜å¤±è´¥
```rust
// âŒ ä¸å¥½
if let Err(_) = operation() {
    // ä»€ä¹ˆéƒ½ä¸åš
}

// âœ… å¥½
if let Err(e) = operation() {
    NotificationSystem::log_error("Operation failed", e);
}
```

## ğŸ”„ è¿ç§»æŒ‡å—

### ä»æ—§ä»£ç è¿ç§»

#### 1. æ›¿æ¢ tracing + push_notification

**æ—§ä»£ç ï¼š**
```rust
tracing::info!("Item saved");
window.push_notification("Item saved successfully", cx);
```

**æ–°ä»£ç ï¼š**
```rust
NotificationSystem::success("Item saved successfully", window, cx);
```

#### 2. æ›¿æ¢çº¯ tracing è°ƒç”¨

**æ—§ä»£ç ï¼š**
```rust
tracing::error!("Failed to save: {:?}", error);
```

**æ–°ä»£ç ï¼š**
```rust
NotificationSystem::log_error("Failed to save", error);
```

#### 3. æ›¿æ¢çº¯ push_notification

**æ—§ä»£ç ï¼š**
```rust
window.push_notification("You have delete ok.", cx);
```

**æ–°ä»£ç ï¼š**
```rust
NotificationSystem::success("Item deleted successfully", window, cx);
```

## ğŸ“ˆ æ€§èƒ½è€ƒè™‘

1. **æ—¥å¿—çº§åˆ«** - åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œdebug æ—¥å¿—ä¼šè¢«è¿‡æ»¤
2. **é€šçŸ¥é¢‘ç‡** - é¿å…çŸ­æ—¶é—´å†…æ˜¾ç¤ºå¤§é‡é€šçŸ¥
3. **å¼‚æ­¥æ“ä½œ** - ä½¿ç”¨ `log_*` æ–¹æ³•é¿å…è·¨çº¿ç¨‹ä¼ é€’ window

## ğŸ§ª æµ‹è¯•

```rust
#[cfg(test)]
mod tests {
    use super::*;

    #[test]
    fn test_notification_levels() {
        // æµ‹è¯•ä¸åŒçº§åˆ«çš„é€šçŸ¥
        // æ³¨æ„ï¼šå®é™…æµ‹è¯•éœ€è¦ mock window å’Œ cx
    }
}
```

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [tracing æ–‡æ¡£](https://docs.rs/tracing/)
- [GPUI é€šçŸ¥ç³»ç»Ÿ](https://github.com/zed-industries/zed)
- [item_info ä¼˜åŒ–å»ºè®®](./item_info_ä¼˜åŒ–å»ºè®®.md)
